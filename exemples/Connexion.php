
<?php

$champvideErr  = $AucuneErr_connexion = $loginmdpErr =  "";

 
if(isset($_POST['valider'])){
       
    function verif_champvide()
    {
    	$champs_vide=array();
         
	    if (empty($_POST['login'])){
	         $champs_vide[]='"login"';
	    }else 
	     
	    if (empty ($_POST['mdp'])){
	         $champs_vide[]='"mdp"';
	    }
	    if (empty ($champs_vide)) {      
	         
	      $login=$_POST['login'];
	      $nom=$_POST['mdp'];
	      return true;

	    } else {
	      return false;
	    }    
    } 

    function verif_login_mdp()
    {
		try
				{
			$bdd = new PDO('mysql:host=localhost;dbname=espace_membre;charset=utf8', 'root', '');
				}
		catch(Exception $e)
				{
				die('Erreur : '.$e->getMessage());
				}


	    $login=$_POST['login'];
	    $cookielogin=setcookie($_POST['login']);
	    $mdp_hache = md5($_POST['mdp']);		

		$req = $bdd->prepare('SELECT id FROM inscription WHERE login ="'.$login.'" AND mdp ="'.$mdp_hache.'"');
		$req->execute(array(
		    'login' => $login,
		    'mdp' => $mdp_hache));

		$resultat = $req->fetch();

		if (!$resultat)
		{
		    return false;
		}
		else
		{

		    return true;
		}
	}

	if ( verif_champvide() == true AND verif_login_mdp() == true) {
		$AucuneErr_connexion = 'Vous êtes connecté !';
		header('location: Page_interaction.php');
	}
	else {

        if (verif_champvide()==false) {

        $champvideErr = "Le formulaire est incomplet";   

        }

        if (verif_login_mdp()==false) {

        $loginmdpErr = "Le login / mot de passe est incorrect";   

        } 
    }    
    
        
}

?>


<!DOCTYPE html>
<html lang="fr">
<head>
		<title>Connexion</title>
		<meta charset="utf-8">
		<link href="../css/Page_interaction.css" rel="stylesheet" >
		<link href="https://fonts.googleapis.com/css?family=Dosis|Archivo+Black" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Harmattan|Nunito|Berkshire+Swash|Libre+Baskerville|Permanent+Marker" rel="stylesheet">
</head>
<body>
		<div class="test">
						<video loop="" muted="" autoplay="" playsinline="">
				<source src="../img/video_login.mp4" type="video/mp4">
			</video>
			<div id="container_formc">
					<div id="container_login_mdp">

						<p style="font-size: 30px;margin-top: 10px; color:#F67059">CONNEXION</p>

						<form method="post" action="<?php echo htmlspecialchars($_SERVER["PHP_SELF"]);?>" class="form_container"  enctype="multipart/form-data">

							Login <br> <input type="text" action="Page_interaction.php" name="login" style="margin:5px"> <br>

							Password <br> <input type="password" name="mdp" style="margin:7px"> <br>

							<a href="Inscription.php" style="text-decoration: none;"><span style="text-decoration: none; color: purple; font-size:14px;">Pas encore inscrit ?</span></a> <br> 

							<input type="submit" value="Se connecter" name="valider"  value="Submit" class="connexion"> <br>


							<span style="color: red;font-size: 12px;margin-bottom: 5px; font-family: Dosis"><?php echo $champvideErr;"\r\n"?></span>

							<span style="color: red;font-size: 12px;margin-bottom: 5px; font-family: Dosis"><?php echo $AucuneErr_connexion;"\r\n"?></span>

							<span style="color: red;font-size: 12px;top:0px;margin-bottom: 5px; font-family: Dosis"><?php echo $loginmdpErr;"\r\n"?></span>

						</form>

					</div>

	    </div>
    	</div>
</body>
</html>